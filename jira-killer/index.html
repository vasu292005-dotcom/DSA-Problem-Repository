<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JIRA Killer</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Space+Mono:wght@400;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #2f3a4e;
      --bg-dark:   #263040;
      --cream:     #ddd5b8;
      --cream-light: #e8e0c8;
      --sidebar:   #8c7f68;
      --input-bg:  #9a8e78;
      --text-dark: #1a1a2e;
      --text-blue: #4a5a7a;
      --text-light: #c8d0de;
      --btn-bg:    #ddd5b8;
      --accent:    #4a5a7a;
    }

    body {
      background: var(--bg);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    /* ── SCREENS ── */
    .screen { display: none; width: 100%; max-width: 900px; animation: fadeIn 0.4s ease; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

    /* ══════════════════════════════════════
       SCREEN 1 — LOGIN
    ══════════════════════════════════════ */
    #screen-login .card {
      background: var(--cream);
      border-radius: 6px;
      display: flex;
      min-height: 480px;
      overflow: hidden;
    }
    #screen-login .sidebar {
      width: 220px;
      background: var(--sidebar);
      flex-shrink: 0;
    }
    #screen-login .form-area {
      flex: 1;
      padding: 48px 52px;
    }
    #screen-login h1 {
      font-family: 'Space Mono', monospace;
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      letter-spacing: 1px;
      margin-bottom: 40px;
    }
    .field-group { margin-bottom: 28px; }
    .field-group label {
      display: block;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1.5px;
      color: var(--text-dark);
      margin-bottom: 10px;
    }
    .field-group input {
      width: 100%;
      max-width: 360px;
      height: 42px;
      background: var(--input-bg);
      border: none;
      border-radius: 4px;
      padding: 0 14px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      color: var(--cream-light);
      outline: none;
      transition: background 0.2s;
    }
    .field-group input::placeholder { color: rgba(220,210,190,0.5); }
    .field-group input:focus { background: #877b65; }

    #login-btn {
      margin-top: 36px;
      background: var(--sidebar);
      color: var(--cream-light);
      border: none;
      border-radius: 4px;
      padding: 12px 40px;
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1.5px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    #login-btn:hover { background: #7a6e58; transform: translateY(-1px); }
    #login-error { color: #c0392b; font-size: 13px; margin-top: 12px; display: none; }

    /* ══════════════════════════════════════
       SCREEN 2 — MAIN (JIRA KILLER)
    ══════════════════════════════════════ */
    #screen-main {
      max-width: 700px;
      margin: 0 auto;
    }
    .hero-banner {
      background: linear-gradient(135deg, var(--cream-light) 0%, #8a9aaa 100%);
      border-radius: 8px;
      padding: 52px 40px 44px;
      text-align: center;
      margin-bottom: 48px;
    }
    .hero-banner h1 {
      font-family: 'Playfair Display', serif;
      font-size: 52px;
      font-weight: 400;
      color: var(--text-blue);
      letter-spacing: 4px;
      margin-bottom: 14px;
    }
    .hero-banner p {
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dark);
      letter-spacing: 0.5px;
    }
    .issue-input-wrap {
      display: flex;
      justify-content: center;
      margin-bottom: 32px;
    }
    #issue-input {
      width: 100%;
      max-width: 620px;
      height: 52px;
      background: var(--cream);
      border: none;
      border-radius: 40px;
      padding: 0 28px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-dark);
      outline: none;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
    }
    #issue-input::placeholder { color: #999; }
    .generate-wrap { display: flex; justify-content: center; }
    #generate-btn {
      background: var(--cream);
      color: var(--text-blue);
      border: none;
      border-radius: 40px;
      padding: 14px 52px;
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 2px;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.12);
      transition: background 0.2s, transform 0.1s;
    }
    #generate-btn:hover { background: var(--cream-light); transform: translateY(-2px); }
    #main-error { color: #e74c3c; font-size: 13px; text-align: center; margin-top: 14px; display: none; }

    /* ══════════════════════════════════════
       SCREEN 3 — PARSED ISSUE
    ══════════════════════════════════════ */
    #screen-parsed { max-width: 900px; }
    .parsed-header {
      background: var(--cream);
      border-radius: 6px;
      padding: 22px 40px;
      text-align: center;
      margin-bottom: 36px;
    }
    .parsed-header h2 {
      font-family: 'Space Mono', monospace;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 3px;
      color: var(--text-blue);
    }
    .parsed-body {
      background: var(--bg-dark);
      border-radius: 6px;
      padding: 36px 40px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
    }
    .parsed-left { }
    .parsed-right {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      gap: 16px;
    }
    .parsed-field { margin-bottom: 24px; }
    .parsed-field .field-label {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      color: var(--text-light);
      margin-bottom: 6px;
    }
    .parsed-field .field-value {
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      color: var(--cream-light);
      line-height: 1.5;
    }
    .tag-box {
      background: var(--cream);
      color: var(--text-blue);
      border-radius: 4px;
      padding: 10px 24px;
      font-family: 'Space Mono', monospace;
      font-size: 14px;
      font-weight: 700;
      display: inline-block;
      margin-bottom: 12px;
    }
    .branch-box {
      margin-top: 8px;
    }
    .branch-box .field-label {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      letter-spacing: 1.5px;
      color: var(--text-light);
      margin-bottom: 4px;
    }
    .branch-box .field-value {
      font-family: 'Space Mono', monospace;
      font-size: 13px;
      color: var(--cream);
    }

    .confirm-btn {
      background: var(--cream);
      color: var(--text-blue);
      border: none;
      border-radius: 4px;
      padding: 12px 32px;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1.5px;
      cursor: pointer;
      width: 200px;
      transition: background 0.2s, transform 0.1s;
    }
    .confirm-btn:hover { background: var(--cream-light); transform: translateY(-1px); }
    .confirm-btn.secondary { background: transparent; border: 2px solid var(--cream); color: var(--cream); }
    .confirm-btn.secondary:hover { background: rgba(221,213,184,0.1); }

    .parsed-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 28px;
    }
    .edit-btn {
      background: var(--cream);
      color: var(--text-blue);
      border: none;
      border-radius: 4px;
      padding: 12px 40px;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1.5px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .edit-btn:hover { background: var(--cream-light); }
    .create-btn {
      background: var(--cream);
      color: var(--text-blue);
      border: none;
      border-radius: 4px;
      padding: 12px 40px;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1.5px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .create-btn:hover { background: var(--cream-light); }
    #parsed-error { color: #e74c3c; font-size: 13px; margin-top: 10px; display: none; }

    /* ══════════════════════════════════════
       SCREEN 4 — SUCCESS
    ══════════════════════════════════════ */
    #screen-success { max-width: 700px; margin: 0 auto; }
    .success-banner {
      background: var(--cream);
      border-radius: 6px;
      padding: 36px 40px;
      text-align: center;
      margin-bottom: 48px;
    }
    .success-banner h2 {
      font-family: 'Space Mono', monospace;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 4px;
      color: var(--text-blue);
    }
    .success-body { padding: 0 12px; }
    .success-field { margin-bottom: 28px; }
    .success-field .s-label {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      color: var(--text-light);
      margin-bottom: 6px;
    }
    .success-field .s-value {
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--cream-light);
    }
    .success-field .s-value a {
      color: var(--cream);
      text-decoration: underline;
    }
    #view-github-btn {
      margin-top: 40px;
      background: var(--cream);
      color: var(--text-blue);
      border: none;
      border-radius: 4px;
      padding: 14px 44px;
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    #view-github-btn:hover { background: var(--cream-light); transform: translateY(-1px); }

    /* ── BACK BUTTON ── */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: transparent;
      border: none;
      color: var(--text-light);
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1.5px;
      cursor: pointer;
      margin-bottom: 20px;
      padding: 6px 0;
      opacity: 0.7;
      transition: opacity 0.2s, transform 0.1s;
    }
    .back-btn:hover { opacity: 1; transform: translateX(-3px); }
    .back-btn::before { content: '←'; font-size: 14px; }

    /* loading spinner */
    .spinner {
      display: none;
      width: 20px; height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: var(--cream);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

<!-- ══ SCREEN 1: LOGIN ══ -->
<div id="screen-login" class="screen active">
  <div class="card">
    <div class="sidebar"></div>
    <div class="form-area">
      <h1>LOGIN</h1>
      <div class="field-group">
        <label>GITHUB USERNAME</label>
        <input type="text" id="inp-owner" placeholder="e.g. vasu292005-dotcom" />
      </div>
      <div class="field-group">
        <label>GITHUB REPOSITORY</label>
        <input type="text" id="inp-repo" placeholder="e.g. DSA-Problem-Repository" />
      </div>
      <div class="field-group">
        <label>GITHUB TOKEN</label>
        <input type="password" id="inp-token" placeholder="github_pat_..." />
      </div>
      <button id="login-btn" onclick="handleLogin()">CONNECT →</button>
      <div id="login-error">⚠ Could not connect. Check your token and repo name.</div>
    </div>
  </div>
</div>

<!-- ══ SCREEN 2: MAIN ══ -->
<div id="screen-main" class="screen">
  <button class="back-btn" onclick="goTo('screen-login')">BACK TO LOGIN</button>
  <div class="hero-banner">
    <h1>JIRA KILLER</h1>
    <p>create GitHub issues using natural language</p>
  </div>
  <div class="issue-input-wrap">
    <input type="text" id="issue-input" placeholder="Describe your issue..." />
  </div>
  <div class="generate-wrap">
    <button id="generate-btn" onclick="handleGenerate()">GENERATE ISSUE</button>
  </div>
  <div id="main-error">⚠ Please describe your issue first.</div>
</div>

<!-- ══ SCREEN 3: PARSED ISSUE ══ -->
<div id="screen-parsed" class="screen">
  <button class="back-btn" onclick="goTo('screen-main')">BACK TO MAIN</button>
  <div class="parsed-header">
    <h2>PARSED ISSUE</h2>
  </div>
  <div class="parsed-body">
    <div class="parsed-left">
      <div class="parsed-field">
        <div class="field-label">TITLE:</div>
        <div class="field-value" id="p-title">—</div>
      </div>
      <div class="parsed-field">
        <div class="field-label">DESCRIPTION:</div>
        <div class="field-value" id="p-desc">—</div>
      </div>
      <div id="p-tags-wrap"></div>
      <div class="branch-box" style="margin-top:16px;">
        <div class="field-label">SUGGESTED BRANCH:</div>
        <div class="field-value" id="p-branch">—</div>
      </div>
    </div>
    <div class="parsed-right">
      <button class="confirm-btn" onclick="handleCreateIssue()">Y ( CONFIRM )</button>
      <button class="confirm-btn secondary" onclick="goTo('screen-main')">N ( NOT CONFIRM )</button>
      <div id="parsed-error"></div>
      <div class="spinner" id="create-spinner"></div>
    </div>
  </div>
  <div class="parsed-footer">
    <button class="edit-btn" onclick="goTo('screen-main')">EDIT</button>
    <button class="create-btn" onclick="handleCreateIssue()">CREATE ISSUE</button>
  </div>
</div>

<!-- ══ SCREEN 4: SUCCESS ══ -->
<div id="screen-success" class="screen">
  <button class="back-btn" onclick="goTo('screen-main')">CREATE ANOTHER ISSUE</button>
  <div class="success-banner">
    <h2>SUCCESS</h2>
  </div>
  <div class="success-body">
    <div class="success-field">
      <div class="s-label">ISSUE NUMBER:</div>
      <div class="s-value" id="s-number">—</div>
    </div>
    <div class="success-field">
      <div class="s-label">ISSUE TITLE:</div>
      <div class="s-value" id="s-title">—</div>
    </div>
    <div class="success-field">
      <div class="s-label">ISSUE URL:</div>
      <div class="s-value" id="s-url">—</div>
    </div>
    <div class="success-field">
      <div class="s-label">SUGGESTED BRANCH COMMAND:</div>
      <div class="s-value" id="s-branch" style="font-family:'Space Mono',monospace;font-size:13px;"></div>
    </div>
    <button id="view-github-btn" onclick="viewOnGitHub()">VIEW ON GITHUB</button>
  </div>
</div>

<script>
  // ── State ──
  let STATE = {
    token: '', owner: '', repo: '',
    issueText: '', parsed: {},
    createdIssue: {}
  };

  // ── Screen navigation ──
  function goTo(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // ── NLP Processing (mirrors Python logic) ──
  function parseLabel(text) {
    const t = text.toLowerCase();
    if (["bug","fix","broken","error","crash","not working"].some(w => t.includes(w))) return "bug";
    if (["feature","add","implement","new","enhance","improve"].some(w => t.includes(w))) return "enhancement";
    if (["docs","documentation","readme"].some(w => t.includes(w))) return "documentation";
    if (["test","testing","coverage"].some(w => t.includes(w))) return "test";
    if (["slow","performance","optimize","speed"].some(w => t.includes(w))) return "performance";
    return "general";
  }

  function parsePriority(text) {
    const t = text.toLowerCase();
    if (["urgent","critical","asap","emergency","blocker"].some(w => t.includes(w))) return "P0 - Critical";
    if (["important","high","major","severe"].some(w => t.includes(w))) return "P1 - High";
    if (["low","minor","trivial"].some(w => t.includes(w))) return "P3 - Low";
    return "P2 - Medium";
  }

  function parseBranch(text, label) {
    const prefix = {bug:"fix", enhancement:"feat", documentation:"docs", test:"test", performance:"perf"}[label] || "feat";
    let slug = text.toLowerCase().replace(/\s+/g, "-").replace(/[^a-z0-9-]/g, "").replace(/-+/g, "-").slice(0, 50).replace(/^-|-$/g, "");
    return prefix + "/" + slug;
  }

  function parseIssue(text) {
    const label    = parseLabel(text);
    const priority = parsePriority(text);
    const branch   = parseBranch(text, label);
    return { title: text, description: text, label, priority, branch };
  }

  // ── SCREEN 1: Login ──
  async function handleLogin() {
    const owner = document.getElementById('inp-owner').value.trim();
    const repo  = document.getElementById('inp-repo').value.trim();
    const token = document.getElementById('inp-token').value.trim();
    const errEl = document.getElementById('login-error');
    errEl.style.display = 'none';

    if (!owner || !repo || !token) { errEl.style.display = 'block'; errEl.textContent = '⚠ Please fill in all fields.'; return; }

    // Validate token by calling GitHub API
    const btn = document.getElementById('login-btn');
    btn.textContent = 'Connecting...';
    try {
      const resp = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
        headers: { 'Authorization': 'Bearer ' + token, 'Accept': 'application/vnd.github+json' }
      });
      if (resp.status === 200) {
        STATE.owner = owner; STATE.repo = repo; STATE.token = token;
        btn.textContent = 'CONNECT →';
        goTo('screen-main');
      } else {
        errEl.style.display = 'block';
        errEl.textContent = '⚠ Could not connect. Check your token, username, and repo name.';
        btn.textContent = 'CONNECT →';
      }
    } catch(e) {
      errEl.style.display = 'block';
      errEl.textContent = '⚠ Network error. Check your internet connection.';
      btn.textContent = 'CONNECT →';
    }
  }

  // ── SCREEN 2: Generate ──
  function handleGenerate() {
    const text = document.getElementById('issue-input').value.trim();
    const errEl = document.getElementById('main-error');
    errEl.style.display = 'none';
    if (!text) { errEl.style.display = 'block'; return; }

    STATE.issueText = text;
    STATE.parsed = parseIssue(text);

    // Populate parsed screen
    document.getElementById('p-title').textContent  = STATE.parsed.title;
    document.getElementById('p-desc').textContent   = STATE.parsed.description;
    document.getElementById('p-branch').textContent = STATE.parsed.branch;

    // Tags
    const tagsWrap = document.getElementById('p-tags-wrap');
    tagsWrap.innerHTML = '';
    [STATE.parsed.label, STATE.parsed.priority].forEach(tag => {
      const el = document.createElement('div');
      el.className = 'tag-box';
      el.textContent = tag;
      tagsWrap.appendChild(el);
    });

    goTo('screen-parsed');
  }

  // ── SCREEN 3: Create Issue ──
  async function handleCreateIssue() {
    const errEl = document.getElementById('parsed-error');
    const spinner = document.getElementById('create-spinner');
    errEl.style.display = 'none';
    spinner.style.display = 'block';

    const body = `## Description\n\n${STATE.parsed.description}\n\n---\n\n## Metadata\n\n| Field | Value |\n|-------|-------|\n| Priority | ${STATE.parsed.priority} |\n| Branch | \`${STATE.parsed.branch}\` |\n| Label | \`${STATE.parsed.label}\` |\n\n---\n\n*Created via JIRA Killer CLI*`;

    try {
      // Try with label first
      let resp = await fetch(`https://api.github.com/repos/${STATE.owner}/${STATE.repo}/issues`, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + STATE.token,
          'Accept': 'application/vnd.github+json',
          'X-GitHub-Api-Version': '2022-11-28',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ title: STATE.parsed.title, body: body, labels: [STATE.parsed.label] })
      });

      // If label doesn't exist (422), retry without label
      if (resp.status === 422) {
        resp = await fetch(`https://api.github.com/repos/${STATE.owner}/${STATE.repo}/issues`, {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + STATE.token,
            'Accept': 'application/vnd.github+json',
            'X-GitHub-Api-Version': '2022-11-28',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ title: STATE.parsed.title, body: body })
        });
      }

      if (resp.status === 201) {
        const data = await resp.json();
        STATE.createdIssue = data;
        spinner.style.display = 'none';

        // Populate success screen
        document.getElementById('s-number').textContent = '#' + data.number;
        document.getElementById('s-title').textContent  = data.title;
        document.getElementById('s-url').innerHTML = `<a href="${data.html_url}" target="_blank">${data.html_url}</a>`;
        document.getElementById('s-branch').textContent = `git checkout -b ${STATE.parsed.branch} && git push -u origin ${STATE.parsed.branch}`;

        goTo('screen-success');
      } else {
        spinner.style.display = 'none';
        errEl.style.display = 'block';
        errEl.textContent = '⚠ Error creating issue. Check your token permissions.';
      }
    } catch(e) {
      spinner.style.display = 'none';
      errEl.style.display = 'block';
      errEl.textContent = '⚠ Network error. Please try again.';
    }
  }

  // ── SCREEN 4: View on GitHub ──
  function viewOnGitHub() {
    if (STATE.createdIssue.html_url) {
      window.open(STATE.createdIssue.html_url, '_blank');
    }
  }

  // Allow pressing Enter on login fields
  ['inp-owner','inp-repo','inp-token'].forEach(id => {
    document.getElementById(id).addEventListener('keydown', e => { if(e.key==='Enter') handleLogin(); });
  });
  document.getElementById('issue-input').addEventListener('keydown', e => { if(e.key==='Enter') handleGenerate(); });
</script>
</body>
</html>